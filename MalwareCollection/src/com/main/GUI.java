package com.main;

import java.awt.Container;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;

import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;

import com.Thread.CollectionThread;

/**
 * @author Robin
 * @date 2016年4月13日 上午8:29:56
 * @version 1.0
 */
public class GUI extends JFrame {
	// 1.成员类
	private class openL implements ActionListener {
		public void actionPerformed(ActionEvent e) {
			JFileChooser c = new JFileChooser();
			c.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
			int rVal = c.showOpenDialog(GUI.this);
			if (rVal == JFileChooser.APPROVE_OPTION)
				choosePathReminder.setText(c.getCurrentDirectory().toString()
						+ File.separator + c.getSelectedFile().getName());
			if (rVal == JFileChooser.CANCEL_OPTION)
				choosePathReminder.setText("未选择文件");
			else
				toCollection.setEnabled(true);
		}
	}

	private class collectionL implements ActionListener {
		public void actionPerformed(ActionEvent e) {
			toCollection.setEnabled(false);
			stop.setEnabled(true);
			stop.setText("终止");
			File folder = new File(choosePathReminder.getText());
			ct = new CollectionThread(folder);
			ct.start();
		}
	}

	private class stopL implements ActionListener {
		@SuppressWarnings("deprecation")
		public void actionPerformed(ActionEvent e) {
			ct.stop();
			stop.setText("被终止");
			stop.setEnabled(false);
		}
	}

	// 2.成员变量
	private JTextField title = new JTextField(12);

	private JButton choosePath = new JButton("选择apk文件夹");
	private JTextField choosePathReminder = new JTextField(30);

	private static JButton toCollection = new JButton("采集签名");
	private static JTextField toCollectionReminder = new JTextField(30);
	private static JButton stop = new JButton("停止");

	private static JTextArea conclusion = new JTextArea(15, 80);
	// 使用的是双反斜，与File.separator一样

	private CollectionThread ct = null;

	// 3.构造函数
	public GUI() {
		super("AndroidAnalysis");
		// 3.1.组件设置
		title.setText("安卓应用签名采集");
		title.setBorder(null);
		title.setFont(new Font("Serif", 0, 24));

		choosePath.addActionListener(new openL());
		toCollection.addActionListener(new collectionL());
		stop.addActionListener(new stopL());

		title.setEditable(false);
		choosePathReminder.setEditable(false);
		toCollectionReminder.setEditable(false);

		this.toCollection.setEnabled(false);
		this.stop.setEnabled(false);

		// 3.2.容器布局设置
		/*
		 * -1----mainPane ----2----operationPanel -------3----titlePanel
		 * -------3----pathChoose -------3----collectionOperation
		 * ----2----conclusionPanel
		 */
		Container mainPane = this.getContentPane();// 一级容器
		// 第一部分：操作选择
		JPanel operationPanel = new JPanel();// 二级容器
		operationPanel.setLayout(new GridLayout(3, 1, 0, 0));

		JPanel titlePanel = new JPanel(); // 三级容器
		titlePanel.setLayout(new FlowLayout(FlowLayout.CENTER));
		titlePanel.add(title);
		operationPanel.add(titlePanel);

		JPanel pathChoose = new JPanel();// 三级容器
		pathChoose.setLayout(new FlowLayout(FlowLayout.LEFT));// 容器设置布局
		pathChoose.add(choosePath);
		pathChoose.add(choosePathReminder);
		operationPanel.add(pathChoose);// 三级容器添加到二级容器

		JPanel collectionOperation = new JPanel();
		collectionOperation.setLayout(new FlowLayout(FlowLayout.LEFT));
		collectionOperation.add(toCollection);
		collectionOperation.add(toCollectionReminder);
		collectionOperation.add(stop);
		operationPanel.add(collectionOperation);// 三级容器添加到二级容器

		// 第二部分：结论显示
		JPanel conclusionPanel = new JPanel();// 二级容器
		conclusionPanel.setLayout(new GridLayout(1, 1, 10, 10));
		JScrollPane jsp = new JScrollPane(conclusion);
		conclusionPanel.add(jsp);

		// 二级容器添加到一级容器
		mainPane.add("North", operationPanel);
		mainPane.add("Center", conclusionPanel);
	}

	// 4.成员函数
	// 4.1 回调函数（被按钮监听器的子线程调用）
	public static void collectionCallFunction(String info) {
		toCollectionReminder.setText(info);
	}

	public static void collectionResultCallFunction(String info) {
		conclusion.append(info);
		conclusion.append("\n");
	}

	// 5.主函数
	public static void main(String[] args) {

		GUI gui = new GUI();
		gui.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		gui.setSize(800, 500);
		gui.setVisible(true);
	}
}
